<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub README Viewer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.1.0/github-markdown-dark.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>

    <style>
        /* --- –¢–í–û–ò –°–¢–ò–õ–ò –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô (—Å–æ–∫—Ä–∞—Ç–∏–ª —Ç—É—Ç –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏) --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #0d1117; color: #c9d1d9; min-height: 100vh; display: flex; flex-direction: column; }
        .container { display: flex; flex-direction: column; height: 100vh; max-height: 100vh; }
        header { background: linear-gradient(90deg, #161b22 0%, #1f242d 100%); padding: 20px 30px; border-bottom: 1px solid #30363d; flex-shrink: 0; }
        .header-content { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
        .repo-header { display: flex; align-items: center; gap: 15px; }
        .repo-icon { font-size: 32px; }
        h1 { font-size: 24px; font-weight: 600; background: linear-gradient(90deg, #58a6ff, #8b949e); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .repo-name { display: flex; align-items: center; gap: 10px; font-size: 18px; color: #58a6ff; }
        .repo-description { color: #8b949e; font-style: italic; margin-top: 8px; font-size: 14px; }
        .repo-stats { display: flex; gap: 20px; flex-wrap: wrap; }
        .stat { display: flex; align-items: center; gap: 6px; color: #8b949e; font-size: 14px; }
        .main-content { flex: 1; overflow: hidden; display: flex; }
        .readme-container { flex: 1; overflow-y: auto; padding: 30px; }
        .markdown-body { background: transparent !important; max-width: 900px; margin: 0 auto; }
        .loading-container, .error-container { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; }
        .spinner { width: 50px; height: 50px; border: 3px solid #30363d; border-top: 3px solid #58a6ff; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        footer { padding: 20px; text-align: center; border-top: 1px solid #30363d; background: #161b22; flex-shrink: 0; font-size: 14px; color: #8b949e; }
    </style>
</head>

<body class="dark-theme">
<div class="container">
    <header>
        <div class="header-content">
            <div class="repo-header">
                <div class="repo-icon">üì¶</div>
                <div>
                    <h1>GitHub README Viewer</h1>
                    <div class="repo-name" id="repoName"></div>
                    <div class="repo-description" id="repoDescription"></div>
                </div>
            </div>
            <div class="repo-stats" id="repoStats"></div>
        </div>
    </header>

    <main class="main-content">
        <div class="readme-container">
            <div class="loading-container" id="loading">
                <div class="spinner"></div>
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ README...</p>
            </div>

            <div class="error-container" id="error" style="display:none;">
                <h2>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h2>
                <p id="errorMessage"></p>
                <button onclick="viewer.loadReadme()">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
            </div>

            <div class="markdown-body" id="readmeContent" style="display:none;"></div>
        </div>
    </main>

    <footer>
        <p id="footerLinks"></p>
        <p>–°–æ–∑–¥–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤</p>
    </footer>
</div>

<script>
class ReadmeViewer {
    constructor() {
        this.converter = new showdown.Converter({ tables: true, tasklists: true, ghCodeBlocks: true });

        // üî• –î–ï–§–û–õ–¢–ù–´–ô –†–ï–ü–û–ó–ò–¢–û–†–ò–ô (–ú–ï–ù–Ø–ï–¢–°–Ø –ó–î–ï–°–¨)
        this.defaultRepo = {
            owner: "UndefinedClear",
            repo: "UndefinedClear-site"
        };

        this.repoConfig = this.getRepoFromQuery();
        this.init();
    }

    getRepoFromQuery() {
        const urlParams = new URLSearchParams(window.location.search);
        const owner = urlParams.get('owner');
        const repo = urlParams.get('repo');
        const fullRepo = urlParams.get('q');

        if (fullRepo && fullRepo.includes('/')) {
            const [o, r] = fullRepo.split('/');
            return { owner: o, repo: r, isDefault: false };
        }

        const pathMatch = window.location.pathname.match(/\/([^\/]+)\/([^\/]+)/);
        if (pathMatch && !owner && !repo) {
            return { owner: pathMatch[1], repo: pathMatch[2], isDefault: false };
        }

        if (owner && repo) return { owner, repo, isDefault: false };

        // üëâ –µ—Å–ª–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –Ω–µ—Ç
        return { ...this.defaultRepo, isDefault: true };
    }

    init() {
        this.updateTitle();
        this.loadReadme();
    }

    updateTitle() {
        document.title = `${this.repoConfig.owner}/${this.repoConfig.repo} - README`;

        repoName.innerHTML = `
            <a href="https://github.com/${this.repoConfig.owner}/${this.repoConfig.repo}" target="_blank">
                ${this.repoConfig.owner}/${this.repoConfig.repo}
            </a>`;

        footerLinks.innerHTML = `
            <a href="https://github.com/${this.repoConfig.owner}/${this.repoConfig.repo}" target="_blank">GitHub</a>
        `;
    }

    async loadReadme() {
        loading.style.display = 'block';
        error.style.display = 'none';
        readmeContent.style.display = 'none';

        try {
            const repoData = await fetch(`https://api.github.com/repos/${this.repoConfig.owner}/${this.repoConfig.repo}`).then(r => r.json());
            repoDescription.textContent = repoData.description || "–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è";

            repoStats.innerHTML = `
                <div class="stat">‚≠ê ${repoData.stargazers_count}</div>
                <div class="stat">üç¥ ${repoData.forks_count}</div>
                <div class="stat">üëÅÔ∏è ${repoData.watchers_count}</div>
                <div class="stat">üêõ ${repoData.open_issues}</div>
            `;

            const readmeApi = await fetch(`https://api.github.com/repos/${this.repoConfig.owner}/${this.repoConfig.repo}/readme`);
            const readmeJson = await readmeApi.json();
            const readmeText = await fetch(readmeJson.download_url).then(r => r.text());

            readmeContent.innerHTML = this.converter.makeHtml(readmeText);
            document.querySelectorAll('pre code').forEach(el => hljs.highlightElement(el));

            loading.style.display = 'none';
            readmeContent.style.display = 'block';

            if (!this.repoConfig.isDefault) this.updateUrl();

        } catch (e) {
            loading.style.display = 'none';
            error.style.display = 'block';
            errorMessage.textContent = "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å README";
        }
    }

    updateUrl() {
        const url = new URL(window.location);
        url.searchParams.set('owner', this.repoConfig.owner);
        url.searchParams.set('repo', this.repoConfig.repo);
        history.replaceState({}, '', url);
    }
}

const viewer = new ReadmeViewer();
</script>
</body>
</html>
